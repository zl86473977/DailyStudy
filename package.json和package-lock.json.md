# package.json

## 管理包

`package.json` 用来描述项目及项目所依赖的模块信息

## 语义版本控制

版本号由三部分组成：major.minor.patch，分别对应 主版本号.次版本号.修补版本号。例如：1.2.3，主要版本1，次要版本2，补丁3。
* `主要版本` 的更改代表了一个破坏兼容性的大变化。 如果用户不适应主要版本更改，则内容将无法正常工作。
* `补丁` 中的更改表示不会破坏任何内容的错误修复。
* `次要版本` 的更改表示不会破坏任何内容的新功能。

## 安装依赖包的版本如何指定
我们安装一些依赖包的时候，版本号前面都会带 ^ 或者 ~ 的符号
* `~` 会匹配最近的小版本依赖包，比如 ~1.2.3 会匹配所有 1.2.x 版本，但是不包括 1.3.0
* `^` 会匹配最新的大版本依赖包，比如 ^1.2.3 会匹配所有 1.x.x 的包，包括 1.3.0，但是不包括 2.0.0
* `*` 安装最新版本的依赖包，比如 *1.2.3 会匹配 x.x.x， // 影响太大 慎用！

## 多人开发时依赖包安装的问题
看了上面版本号的指定后，我们可以知道，当我们使用了 ^ 或者 ~ 来控制依赖包版本号的时候 ，多人开发，就有可能存在大家安装的依赖包版本不一样的情况，就会存在项目运行的结果不一样。

为了解决这个不同人电脑安装的所有依赖版本都是一致的，确保项目代码在安装所执行的运行结果都一样，这时 `package-lock.json` 就应运而生了。

# package-lock.json

`package-lock.json` 是在 npm(^5.x.x.x)后才有，中途有几次更改

`package-lock.json` 它会在 npm 更改 `node_modules` 目录树 或者 `package.json` 时自动生成的，它准确的描述了当前项目npm包的依赖树,并且在随后的安装中会根据 package-lock.json 来安装,，保证是相同的一个依赖树，不考虑这个过程中是否有某个依赖有小版本的更新。

它的产生就是来对整个依赖树进行版本固定的（锁死）。

当我们在一个项目中npm install时候，会自动生成一个package-lock.json文件，和package.json在同一级目录下。package-lock.json记录了项目的一些信息和所依赖的模块。这样在每次安装都会出现相同的结果. 不管你在什么机器上面或什么时候安装。

当我们下次再npm install时候，npm 发现如果项目中有 package-lock.json 文件，会根据 package-lock.json 里的内容来处理和安装依赖而不再根据 package.json。

> 注意，使用cnpm install时候，并不会生成 package-lock.json 文件，也不会根据 package-lock.json 来安装依赖包，还是会使用 package.json 来安装。

## package-lock.json 生成逻辑

在一般情况下（无冲突）package-lock.json, 会生成类似下面铺平的结构

    { 
        "name": "lock-test",  
        "version": "1.0.0",  
        "dependencies": {    
            "A": { "version": "1.0.0" },
            "B": { "version": "1.0.0" },
            "C": { "version": "1.0.0" }  
        }
    }

如果A中包含了B的依赖，并且和原来的B又冲突，npm 使用嵌套描述这种行为
    
    {  
        "name": "lock-test",
        "version": "1.0.0",  
        "dependencies": {    
            "A": {      
                "version": "1.1.0",      
                "dependencies": {        
                    "B": { "version": "1.0.0" }      
                }    
            },    
            "B": { "version": "2.0.0" },    
            "C": { "version": "1.0.0" }  
        }
    }

## package-lock.json 可能被意外更改的原因
1. package.json 文件修改了
2. 挪动了包的位置

将部分包的位置从 dependencies 移动到 devDependencies 这种操作，虽然包未变，但是也会影响 package-lock.json，会将部分包的 dev 字段设置为 true

3. registry 的影响

就算版本一样，安装源 registry 不同，执行 npm i 时也会修改 package-lock.json

`package-lock.json` 是不会无缘无故被更改的，一定是因为 `package.json` 或者 `node_modules` 被更改了，因为 package-lock.json 为了能够精准的反映出我们 node_modules 的结构
